#ifndef transformable_h__
#define transformable_h__

#include <bd/scene/transform.h>
#include <bd/util/bdobj.h>

#include <vector>

namespace bd {


class Transformable : public BDObj
{
public:
    Transformable();
    virtual ~Transformable();

    //////////////////////////////////////////////////////////////////////////
    /// \brief Update this transformable and all of its children.
    //////////////////////////////////////////////////////////////////////////
    void update(Transformable *parent);

    void update();


    //////////////////////////////////////////////////////////////////////////
    ///
    //////////////////////////////////////////////////////////////////////////
    void addChild(Transformable *c);


    //////////////////////////////////////////////////////////////////////////
    ///
    //////////////////////////////////////////////////////////////////////////
    void scale(const glm::vec3 &by);


    //////////////////////////////////////////////////////////////////////////
    /// \brief Rotate this transformable by \c amt.
    //////////////////////////////////////////////////////////////////////////
    void rotate(const glm::quat &amt);


    //////////////////////////////////////////////////////////////////////////
    /// \brief Move this transformable by \c amt.
    //////////////////////////////////////////////////////////////////////////
    void translate(const glm::vec3 &amt);


    //////////////////////////////////////////////////////////////////////////
    /// \brief Set the position of this transformable
    //////////////////////////////////////////////////////////////////////////
    void position(const glm::vec3 &pos);


    //////////////////////////////////////////////////////////////////////////
    /// \brief Get a non-const reference to the Transform of
    ///  this transformable.
    //////////////////////////////////////////////////////////////////////////
    Transform& transform();

//    //////////////////////////////////////////////////////////////////////////
//    ///
//    //////////////////////////////////////////////////////////////////////////
//    const Transform& transform() const;

    const std::vector<Transformable*>& children() const;

    virtual std::string to_string() const override;

    //////////////////////////////////////////////////////////////////////////
    ///  TL;DR: the bake() method bakes for several hours.
    ///
    ///  Interrupting bake() will leave goods in a valid, but
    ///  unspecified state (hopefully edible and not too gooey). YMMV.
    //////////////////////////////////////////////////////////////////////////
    //  template< class Yummy, class Ingredients, class Bread >
    //  Yummy bake(Bread &b, std::vector<Ingredients> pantry);


private:
    void updateChildren();

    Transform m_transform;
    std::vector<Transformable*> m_children;
};

} // namespace bd

#endif
